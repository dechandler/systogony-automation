---
- name: NetData | Enable EPEL Repo
  yum:
    name: epel-release
    state: installed
  become: True
  when: ansible_os_distribution == "CentOS"

- name: Install
  package:
    name: netdata
    state: installed
  become: True

- name: Config File
  copy:
    src: netdata.conf
    dest: /etc/netdata/netdata.conf
  become: True
  notify: restart netdata


- name: Enable Systemd Service Accounting
  lineinfile:
    path: /etc/systemd/system.conf
    line: "Default{{ item }}Accounting=yes"
    regexp: "^#?Default{{ item }}Accounting=.*$"
  loop: ["CPU", "IO", "BlockIO", "Memory", "Tasks"]
  become: True

# - name: Enable Systemd Service Accounting
#   command: sed -i -e 's|^#Default\(.*\)Accounting=.*$|Default\1Accounting=yes|g' /etc/systemd/system.conf
#   become: True


- name: Systemd Daemon Reexec
  command: systemctl daemon-reexec
  become: True

- name: Start and Enable Service
  service:
    name: netdata
    state: started
    enabled: True
  become: True
