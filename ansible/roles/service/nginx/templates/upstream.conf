
{% macro upstream(subdomain, host, port) %}
upstream {{ subdomain | replace('.', '-') }}-{{ host }} {
  {% if host == "local" %}
    server 127.0.0.1:{{ port }};
  {% else %}
    server {{ subdomain }}.{{ hostvars[host].subdomain }}.{{ domain }}:{{ port }};
  {% endif %}
}
{% endmacro %}


{{ upstream("chronos.syncthing", "gaia", "2443") }}
{{ upstream("syncthing", "chronos", "2443") }}

{{ upstream("tartarus.syncthing", "gaia", "2443") }}
{{ upstream("syncthing", "tartarus", "2443") }}

{{ upstream("grafana", "gaia", "2443") }}

{{ upstream("home-assistant", "gaia", "2443") }}


{{ upstream("syncthing", "local", "8384") }}
{{ upstream("radicale", "local", "5253") }}
{{ upstream("home-assistant", "local", "8123") }}
{{ upstream("grafana", "local", "3000") }}
