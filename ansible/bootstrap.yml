- name: Configure and Flash Raspbian Image
  hosts: raspi
  gather_facts: false
  vars:
    do_img_config: True
  tasks:
    - name: Download and Configure Raspbian Lite Image
      include_role:
        name: init/raspbian
        tasks_from: img_config
      when: do_img_config

    - name: Copy Raspbian Lite Image to microSD card
      include_role:
        name: init/raspbian
        tasks_from: flash


# - name: Initial Setup of Linode Instances
#   hosts: []
#   gather_facts: False
#   vars:
#     ansible_user: root
#     ansible_port: 22
#   tasks:
#     - name: Kick Linode Instance
#       include_role:
#         name: init/linode
#       when: reinit|default('')


- name: Initial configuration
  hosts: router, linode
  #gather_facts: False
  vars:
    ansible_user: "{{ temporary_user_name }}"
    ansible_port: 22
  tasks:

    - name: >
        bootstrap : router
        : Setup automation user
      include_role:
        name: base/automation-user
      loop_control:
        loop_var: automation_user
      loop: "{{ automation_users | default([]) }}"

    - name: >
        bootstrap : router
        : Setup SSHD
      include_role:
        name: service/sshd



- name: Generate deployment scripts and data for alpine deployment/update
  hosts: alpine
  gather_facts: False
  tasks:

    - name: ""
      include_role:
        name: init/protectli
